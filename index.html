<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>实时代码编辑器</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/dracula.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/htmlmixed/htmlmixed.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/css/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.14.0/beautify.min.js"></script>
    <style>
        body {
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        .editor-container {
            display: flex;
            flex: 1;
        }
        .editor {
            flex: 1;
            padding: 10px;
        }
        .preview {
            flex: 1;
        }
        iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        .controls {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background-color: #f1f1f1;
        }
        button {
            padding: 10px 20px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="controls">
        <button onclick="exportHTML()">导出</button>
        <button onclick="openPreviewInNewTab()">分离预览</button>
        <button onclick="toggleTheme()">切换主题</button>
        <button onclick="formatCode()">格式化</button>
    </div>
    <div class="editor-container">
        <div id="html-editor" class="editor"></div>
        <div id="css-editor" class="editor"></div>
        <div id="js-editor" class="editor"></div>
    </div>
    <div class="preview">
        <iframe id="preview-frame"></iframe>
    </div>

    <script>
        let htmlEditor = CodeMirror(document.getElementById('html-editor'), {
            value: "<!DOCTYPE html>\\n<html>\\n<head>\\n\\t<title>Document</title>\\n</head>\\n<body>\\n\\n</body>\\n</html>",
            mode: "htmlmixed",
            theme: "dracula",
            lineNumbers: true,
            autoCloseTags: true,
            matchBrackets: true,
            extraKeys: {"Ctrl-Space": "autocomplete"}
        });

        let cssEditor = CodeMirror(document.getElementById('css-editor'), {
            value: "/* CSS code here */",
            mode: "css",
            theme: "dracula",
            lineNumbers: true,
            autoCloseBrackets: true,
            matchBrackets: true,
            extraKeys: {"Ctrl-Space": "autocomplete"}
        });

        let jsEditor = CodeMirror(document.getElementById('js-editor'), {
            value: "// JavaScript code here",
            mode: "javascript",
            theme: "dracula",
            lineNumbers: true,
            autoCloseBrackets: true,
            matchBrackets: true,
            extraKeys: {"Ctrl-Space": "autocomplete"}
        });

        let previewFrame = document.getElementById('preview-frame');

        function updatePreview() {
            try {
                let htmlContent = htmlEditor.getValue();
                let cssContent = `<style>${cssEditor.getValue()}</style>`;
                let jsContent = `<script>${jsEditor.getValue()}<\\/script>`;
                previewFrame.srcdoc = htmlContent + cssContent + jsContent;
            } catch (error) {
                Swal.fire({
                    icon: 'error',
                    title: 'Oops...',
                    text: '代码中有错误，请检查！'
                });
            }
        }

        htmlEditor.on('change', updatePreview);
        cssEditor.on('change', updatePreview);
        jsEditor.on('change', updatePreview);

        function exportHTML() {
            let htmlContent = htmlEditor.getValue();
            let cssContent = `<style>${cssEditor.getValue()}</style>`;
            let jsContent = `<script>${jsEditor.getValue()}<\\/script>`;
            let fullContent = htmlContent + cssContent + jsContent;

            let blob = new Blob([fullContent], { type: 'text/html' });
            let url = URL.createObjectURL(blob);
            let a = document.createElement('a');
            a.href = url;
            a.download = 'index.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function openPreviewInNewTab() {
            let htmlContent = htmlEditor.getValue();
            let cssContent = `<style>${cssEditor.getValue()}</style>`;
            let jsContent = `<script>${jsEditor.getValue()}<\\/script>`;
            let fullContent = htmlContent + cssContent + jsContent;

            let newWindow = window.open();
            newWindow.document.write(fullContent);
            newWindow.document.close();
        }

        let isDarkTheme = true;

        function toggleTheme() {
            isDarkTheme = !isDarkTheme;
            let theme = isDarkTheme ? "dracula" : "default";
            htmlEditor.setOption("theme", theme);
            cssEditor.setOption("theme", theme);
            jsEditor.setOption("theme", theme);
        }

        function formatCode() {
            htmlEditor.setValue(html_beautify(htmlEditor.getValue()));
            cssEditor.setValue(css_beautify(cssEditor.getValue()));
            jsEditor.setValue(js_beautify(jsEditor.getValue()));
        }
    </script>
</body>
</html>
